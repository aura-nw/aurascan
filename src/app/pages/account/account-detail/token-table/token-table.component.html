<div *ngIf="assetsLoading" class="mt-14">
  <app-loading-sprint></app-loading-sprint>
</div>

<section *ngIf="!assetsLoading">
  <div class="sub-text fw-semibold">Coins & Tokens ({{ assetCW20?.length || 0 }})</div>
  <div class="mt-4">
    <div class="card mt-5">
      <div class="card-body">
        <!-- Title -->
        <div class="d-lg-flex justify-content-between">
          <div>
            <div class="mb-4 mb-lg-0 d-flex justify-content-between d-lg-block">
              <div class="sub-text text-gradient fw-semibold">
                $ {{ total || 0 | number: global.formatNumber2Decimal }}
              </div>
            </div>
          </div>
          <div class="position-relative">
            <form class="aura-form single-input-field search-form account-search-form mt-2 mt-lg-0" #searchForm>
              <div class="input-group small-input">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Search for Token Name or Address"
                  [(ngModel)]="textSearch"
                  [maxLength]="maxLengthSearch"
                  (keyup.enter)="searchToken()"
                  name="search"
                  autocomplete="off" />
                <button
                  type="submit"
                  class="btn-search {{ textSearch && textSearch?.length > 0 ? 'd-none' : '' }}"
                  (click)="searchToken()">
                  <img [src]="'assets/icons/icons-svg/basic/search.svg' | imageS3" alt="" width="24" height="24" />
                </button>
                <button
                  type="reset"
                  class="btn-reset {{ !textSearch || (textSearch && textSearch?.length === 0) ? 'd-none' : '' }}"
                  (click)="resetSearch()">
                  <img
                    [src]="'assets/icons/icons-svg/basic/close-circle.svg' | imageS3"
                    alt=""
                    width="24"
                    height="24" />
                </button>
              </div>
            </form>
          </div>
        </div>
        <ng-container *ngIf="pageData?.length > 0; else noValues">
          <!-- Table -->
          <div class="table-responsive aura-table-contain mt-4 table-token">
            <table mat-table matSort [dataSource]="dataSource" class="aura-table" (matSortChange)="sortData($event)">
              <!-- Asset Column -->
              <ng-container matColumnDef="asset">
                <th mat-header-cell *matHeaderCellDef>ASSET</th>
                <td mat-cell *matCellDef="let element">
                  <a
                    class="d-flex align-items-center"
                    [routerLink]="['/tokens/token', element.contract_address]"
                    *ngIf="element.contract_address">
                    <img [src]="element.image" width="24px" height="24px" />
                    <div class="ml-2">
                      {{ element.name }}
                    </div>
                  </a>
                  <div class="d-flex align-items-center" *ngIf="!element.contract_address">
                    <img [src]="element.image" width="24px" height="24px" />
                    <div class="ml-2">
                      {{ element.name }}
                    </div>
                  </div>
                </td>
              </ng-container>

              <!-- SYMBOL Column -->
              <ng-container matColumnDef="symbol">
                <th mat-header-cell *matHeaderCellDef>SYMBOL</th>
                <td mat-cell *matCellDef="let element">
                  <span>{{ element.symbol }}</span>
                </td>
              </ng-container>

              <!-- CONTRACT ADDRESS Column -->
              <ng-container matColumnDef="contractAddress">
                <th mat-header-cell *matHeaderCellDef>CONTRACT ADDRESS</th>
                <td mat-cell *matCellDef="let element" class="vertical-align-top py-4">
                  <a
                    class="d-flex align-items-center"
                    [routerLink]="['/contracts', element.contract_address]"
                    *ngIf="element.contract_address">
                    <img [src]="'assets/icons/icons-svg/basic/file-text.svg' | imageS3" width="24px" height="24px" />
                    <div class="ml-2 text--green">
                      {{ element.contract_address | cutStringPipe: 8:8 }}
                    </div>
                  </a>
                  <span *ngIf="!element.contract_address">-</span>
                </td>
              </ng-container>

              <!-- AMOUNT Column -->
              <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef class="">AMOUNT</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.balance | number: global.formatNumberToken }}
                </td>
              </ng-container>

              <!-- PRICE Column -->
              <ng-container matColumnDef="price">
                <th mat-header-cell *matHeaderCellDef class="">PRICE</th>
                <td mat-cell *matCellDef="let element">
                  <ng-container *ngIf="element.contract_address">
                    <span *ngIf="element.price; else defaultValues"
                      >${{ element.price | number: global.formatNumber2Decimal }}</span
                    >
                  </ng-container>
                  <ng-container *ngIf="!element.contract_address">
                    <span *ngIf="element.price; else defaultValues"
                      >${{ global.tokenPrice | number: global.formatNumber2Decimal }}</span
                    >
                  </ng-container>
                </td>
              </ng-container>

              <!-- CHANCE (24h) Column -->
              <ng-container matColumnDef="chance">
                <th mat-header-cell *matHeaderCellDef class="">CHANGE (24H)</th>
                <td mat-cell *matCellDef="let element">
                  <!-- <div class="aura__change {{ element.chance > 0 ? 'aura__change--asc' : 'aura__change--desc' }} ">
          {{ math.abs(element.chance) }}
        </div> -->-
                </td>
              </ng-container>

              <!-- VALUE Column -->
              <ng-container matColumnDef="value">
                <th mat-header-cell *matHeaderCellDef>VALUE</th>
                <td mat-cell *matCellDef="let element">
                  <ng-container *ngIf="element.contract_address">
                    <span *ngIf="element.price; else defaultValues"
                      >${{ element.price * element.balance | number: global.formatNumber2Decimal }}</span
                    >
                  </ng-container>
                  <ng-container *ngIf="!element.contract_address">
                    <span *ngIf="element.price; else defaultValues"
                      >${{ global.tokenPrice * element.balance | number: global.formatNumber2Decimal }}</span
                    >
                  </ng-container>
                </td>
              </ng-container>

              <ng-template #defaultValues>-</ng-template>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
              <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell g-no-data" colspan="9999">
                  {{ 'NO DATA' | translate }}
                </td>
              </tr>
            </table>
            <app-paginator
              [length]="pageData.length"
              [pageSize]="pageData.pageSize"
              (paginator)="paginatorEmit($event)"
              (pageEvent)="handlePageEvent($event)">
            </app-paginator>
          </div>
        </ng-container>
        <ng-template #noValues>
          <div class="card">
            <app-table-no-data [textNull]="'No coin & tokens'"></app-table-no-data>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</section>
